<!-- Comments Button & Modal Component -->
<style>
  /* FIX FOR MODAL BLINKING - Add these specific rules */
  [data-toggle="modal"] {
    transition: none !important;
  }

  [data-toggle="modal"]:hover {
    transform: none !important;
    box-shadow: none !important;
  }

  .btn-action[data-toggle="modal"] {
    transition: none !important;
  }

  .btn-action[data-toggle="modal"]:hover {
    transform: none !important;
    box-shadow: none !important;
  }

  /* Specifically override any recipe-card hover effects for modal buttons */
  .recipe-card:hover [data-toggle="modal"] {
    transform: none !important;
  }

  /* Nuclear option - remove all transitions from buttons in recipe cards */
  .recipe-actions .btn {
    transition: none !important;
  }

  .recipe-actions .btn:hover {
    transform: none !important;
    box-shadow: none !important;
  }
</style>
<button
  type="button"
  class="btn btn-info btn-sm btn-action no-hover-effect"
  data-toggle="modal"
  data-target="#commentsModal-{{ recipe.id }}"
  style="transition: none !important; transform: none !important"
>
  üí¨ Comments ({{ recipe.comment_count or 0 }})
</button>

<!-- Comments Modal -->
<div
  class="modal fade"
  id="commentsModal-{{ recipe.id }}"
  tabindex="-1"
  role="dialog"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
          &times;
        </button>
        <h4 class="modal-title">üí¨ Comments for {{ recipe.title }}</h4>
      </div>

      <!-- Comments List - Scrollable -->
      <div class="modal-body" style="padding: 0">
        <div
          id="comments-list-{{ recipe.id }}"
          style="max-height: 300px; overflow-y: auto; padding: 15px"
        >
          {% for comment in recipe.comments %}
          <div
            class="comment"
            style="
              border-bottom: 1px solid #eee;
              padding: 10px 0;
              display: flex;
              justify-content: space-between;
              align-items: flex-start;
            "
          >
            <div style="flex: 1">
              <strong>{{ comment.username }}</strong>
              <small class="text-muted"
                >{{ comment.created_at.strftime('%Y-%m-%d %H:%M') }}</small
              >
              <p>{{ comment.comment_text }}</p>
            </div>

            <!-- DELETE BUTTON - Only show if user owns comment or is admin -->
            {% if session.user_id == comment.user_id or session.role == 'admin'
            %}
            <button
              class="btn btn-border-primary btn-xs delete-comment-btn"
              data-comment-id="{{ comment.id }}"
              style="margin-left: 15px; padding: 4px 8px"
            >
              üóëÔ∏è
            </button>
            {% endif %}
          </div>
          {% else %}
          <p class="text-muted">No comments yet. Be the first to comment!</p>
          {% endfor %}
        </div>
      </div>

      <!-- Comment Form - Fixed at Bottom -->
      <div
        class="modal-footer"
        style="display: block; border-top: 1px solid #e5e5e5"
      >
        <form id="comment-form-{{ recipe.id }}">
          <div class="form-group">
            <textarea
              class="form-control"
              name="comment_text"
              rows="3"
              placeholder="Share your thoughts about this recipe..."
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Post Comment</button>
        </form>
      </div>
    </div>
  </div>
</div>
